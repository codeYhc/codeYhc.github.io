!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,()=>(()=>{"use strict";function e(e){e&&e.parentNode&&document.body.removeChild(e)}const t={apiBaseUrl:"https://your-backend-api.com",apiTimeout:3e4,headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_TOKEN","X-Custom-Header":"custom-value"}},n={async post(e,n){const o=new AbortController,r=setTimeout(()=>o.abort(),t.apiTimeout);try{const i=await fetch(`${t.apiBaseUrl}${e}`,{method:"POST",headers:t.headers,body:JSON.stringify(n),signal:o.signal});if(clearTimeout(r),!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.message||`HTTP错误: ${i.status}`)}return await i.json()}catch(e){if(clearTimeout(r),"AbortError"===e.name)throw new Error("请求超时，请稍后重试");throw e}},async get(e){const n=await fetch(`${t.apiBaseUrl}${e}`,{method:"GET",headers:t.headers});if(!n.ok)throw new Error(`HTTP错误: ${n.status}`);return await n.json()}},o={validateForm(e){if(!e.inputData||e.inputData.trim().length<3)throw new Error("输入内容至少需要3个字符");if(e.inputData.length>100)throw new Error("输入内容不能超过100个字符");return!0},getPageInfo:()=>({title:document.title,url:window.location.href,selectedText:window.getSelection().toString(),metaDescription:document.querySelector('meta[name="description"]')?.content||"",metaKeywords:document.querySelector('meta[name="keywords"]')?.content||"",mainImage:document.querySelector('meta[property="og:image"]')?.content||document.querySelector("img")?.src||""}),highlightElements(e){const t=document.querySelectorAll(e);return t.forEach(e=>{e.style.outline="2px solid #ff0000",e.style.backgroundColor="rgba(255, 255, 0, 0.3)"}),t.length},extractData(){const e=Array.from(document.querySelectorAll("a")).map(e=>({text:e.textContent.trim(),href:e.href})).filter(e=>e.href&&e.text),t=Array.from(document.querySelectorAll("table")).map((e,t)=>({index:t,rowCount:e.rows.length,columnCount:e.rows[0]?.cells.length||0}));return{linkCount:e.length,topLinks:e.slice(0,5),tables:t}},async processSubmit(e){try{this.validateForm(e);const t=this.getPageInfo(),o=this.extractData(),r={userInput:e.inputData.trim(),remark:e.inputRemark.trim(),pageInfo:t,extractedData:o,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,language:navigator.language,processed:!0};console.log("处理后的数据：",r);return{success:!0,message:"提交成功！",data:await n.post("/api/submit",r)}}catch(e){throw console.error("业务逻辑错误：",e),e}}};return console.log("Hello, world!"),function(t){if(document.getElementById("custom-bookmarklet-modal"))return;const n=function(){const e=document.createElement("div");return e.id="custom-bookmarklet-modal",e.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.5);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 999999;\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n    ',e}(),o=function(){const e=document.createElement("div");return e.style.cssText="\n      background: white;\n      padding: 24px;\n      border-radius: 8px;\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n      min-width: 400px;\n      max-width: 90%;\n      max-height: 80vh;\n      overflow-y: auto;\n    ",e}(),r=function(){const e=document.createElement("form");return e.innerHTML='\n      <h2 style="margin: 0 0 20px 0; color: #333; font-size: 20px;">数据提交表单</h2>\n      \n      <div style="margin-bottom: 16px;">\n        <label style="display: block; margin-bottom: 6px; color: #555; font-weight: 500;">\n          输入内容：\n        </label>\n        <input \n          type="text" \n          id="inputData" \n          name="inputData"\n          required\n          style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 14px;"\n          placeholder="请输入数据"\n        />\n      </div>\n  \n      <div style="margin-bottom: 16px;">\n        <label style="display: block; margin-bottom: 6px; color: #555; font-weight: 500;">\n          备注：\n        </label>\n        <textarea \n          id="inputRemark" \n          name="inputRemark"\n          rows="3"\n          style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 14px; resize: vertical;"\n          placeholder="选填"\n        ></textarea>\n      </div>\n  \n      <div id="errorMsg" style="color: #d32f2f; margin-bottom: 16px; font-size: 14px; display: none; padding: 10px; background: #ffebee; border-radius: 4px;"></div>\n      <div id="successMsg" style="color: #388e3c; margin-bottom: 16px; font-size: 14px; display: none; padding: 10px; background: #e8f5e9; border-radius: 4px;"></div>\n      <div id="loadingMsg" style="color: #1976d2; margin-bottom: 16px; font-size: 14px; display: none; padding: 10px; background: #e3f2fd; border-radius: 4px;">处理中...</div>\n  \n      <div style="display: flex; gap: 12px; justify-content: flex-end;">\n        <button \n          type="button" \n          id="cancelBtn"\n          style="padding: 10px 20px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 14px; color: #555;"\n        >\n          取消\n        </button>\n        <button \n          type="submit"\n          id="submitBtn"\n          style="padding: 10px 20px; border: none; background: #1976d2; color: white; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;"\n        >\n          提交\n        </button>\n      </div>\n    ',e}();o.appendChild(r),n.appendChild(o),document.body.appendChild(n),function(t,n,o){document.getElementById("cancelBtn").addEventListener("click",()=>e(t)),t.addEventListener("click",function(n){n.target===t&&e(t)}),n.addEventListener("submit",async function(n){n.preventDefault();const r=document.getElementById("errorMsg"),i=document.getElementById("successMsg"),a=document.getElementById("loadingMsg"),d=document.getElementById("submitBtn");r.style.display="none",i.style.display="none",a.style.display="block",d.disabled=!0;try{const n={inputData:document.getElementById("inputData").value,inputRemark:document.getElementById("inputRemark").value},r=await o.processSubmit(n);a.style.display="none",i.textContent=r.message,i.style.display="block",setTimeout(()=>e(t),2e3)}catch(e){console.error("提交错误：",e),a.style.display="none",r.textContent=e.message||"提交失败，请重试",r.style.display="block",d.disabled=!1}});const r=function(n){"Escape"===n.key&&document.getElementById("custom-bookmarklet-modal")&&(e(t),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r)}(n,r,t),document.getElementById("inputData").focus()}(o),{}})());